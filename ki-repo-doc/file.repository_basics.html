<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
<title>
  File: Ki: Repository basics
  
    &mdash; Documentation by YARD 0.8.7
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: Ki: Repository basics</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'><h1>Getting started</h1>

<ol>
<li><p>Create a version and import it to repository</p>

<pre class="code ruby"><code class="ruby"> echo 'Hello World!' &gt; test.sh
 echo &quot;Simple demo&quot; &gt; &quot;readme.txt&quot;
 chmod u+x test.sh
 ki version-build test.sh
 ki version-build readme* -t doc
 ki version-import -m -c my/component
 ki version-show my/component
</code></pre>

<ul>
<li><code>version-import -c</code> creates a new version under <code>"my/component`` and</code>-m` moves the files to version's repository directory</li>
<li><code>version-show</code> looks for the latest available version and shows information about that</li>
</ul>
</li>
<li><p>Create another version, with dependency to <code>my/component/1</code> and import that too</p>

<pre class="code ruby"><code class="ruby"> ki pref prefix version
 ki build -d my/component/1,name=comp,path=doc,internal -O &quot;mv doc/test.sh helloworld.sh&quot;
 ki import -m -c my/product
 ki show -r my/product
 ki export my/product -o export
 find export
</code></pre>

<ul>
<li><code>ki pref prefix version</code> configures a shortcut to call version commands with shorter syntax</li>
<li><code>version-build</code> generates a dependency to <code>"my/component/1"</code> and puts the files from <code>"my/component/1"</code> to doc directory</li>
<li><code>version-build -O</code> operations are executed when the product version is exported, <code>"doc/test.sh"</code> is moved to helloworld.sh</li>
<li><p>the contents of "export" directory should be:</p>

<pre class="code ruby"><code class="ruby">  <span class='id identifier rubyid_export'>export</span>
  <span class='id identifier rubyid_export'>export</span><span class='op'>/</span><span class='id identifier rubyid_doc'>doc</span>
  <span class='id identifier rubyid_export'>export</span><span class='op'>/</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>/</span><span class='id identifier rubyid_readme'>readme</span><span class='period'>.</span><span class='id identifier rubyid_txt'>txt</span>
  <span class='id identifier rubyid_export'>export</span><span class='op'>/</span><span class='id identifier rubyid_helloworld'>helloworld</span><span class='period'>.</span><span class='id identifier rubyid_sh'>sh</span>
</code></pre></li>
</ul>
</li>
</ol>


<h1>Repository structure: versions, components</h1>

<p>Ki-Repo is a repository for storing file packages and metadata about those packages.</p>

<p>An example repository has following structure:</p>

<ul>
<li>Repository has three components: <code>"my/componentA"</code>, <code>"my/componentB"</code>, <code>"my/product"</code>.</li>
<li>Each component maintains a chronological list of versions. For example, <code>"my/component"</code> has versions <code>"23"</code>, <code>"22"</code> and <code>"21"</code>.</li>
<li>Component's name should be a unique identifier and it can include any number of identifiers. Valid component names include <code>"ki/repo"</code>, <code>"ki-repo"</code> or <code>"my/test/builds/ki/repo/"</code>.</li>
<li>Version contains a set of files. Version can also define dependencies and other metadata.</li>
</ul>


<p>The repository and its directories and files would look like this:</p>

<pre class="code ruby"><code class="ruby">repository/
  my/
    component/
      23/
        jar/lib.jar
        readme.txt
        start.sh
      22/
        jar/lib.jar
        readme.txt
        start.sh
      21/
        jar/lib.jar
        readme.txt
        start.sh
    componentB/
      build-211/
        lib/utils.rb
      build-210/
        ...
      build-209/
      ...
    product/
      98/
      97/
      ...
</code></pre>

<h2>Version</h2>

<p>Each version identifies a unique combination of files and dependencies. After version has been built and imported to
repository it does not change. This ensures that when ever the version is used, the contents stay the same.</p>

<p>In addition to having files, version can define metadata about its files (size, permission bits, hash checksums), origins and dependencies.
Files can also be tagged with identifiers to make it easier to identify files of different types. Versions can also have status
information (for example "IntegrationTest=green"), which makes it easier to search for versions.</p>

<p>Version's full name is the name of the component and the version name: <code>"my/component/23"</code></p>

<h3>File metadata</h3>

<pre class="code ruby"><code class="ruby">{ &quot;path&quot;: &quot;test.sh&quot;, &quot;size&quot;: 2, &quot;executable&quot;: true, &quot;tags&quot;: [ &quot;test-start&quot; ], &quot;sha1&quot;: &quot;9a900f538965a426994e1e90600920aff0b4e8d2&quot; }
</code></pre>

<ul>
<li>path identifies the actual file (stored in the version)</li>
<li>size and sha1 are calculated when version is built</li>
<li>executable is stored when version is built and ki ensures that when the file is in repository or exported is has its executable flag set on</li>
<li>file tags can be used to tag files with different identifiers</li>
</ul>


<h3>Source information</h3>

<pre class="code ruby"><code class="ruby">{ &quot;url&quot;: &quot;http://test.repo/component@21331&quot;, &quot;tag-url&quot;: &quot;http://test.repo/component/tags/23&quot;, &quot;repotype&quot;: &quot;git&quot;, &quot;author&quot;: &quot;john&quot; }
</code></pre>

<ul>
<li>source information is used to store reference to the original source of the package</li>
</ul>


<h3>Dependencies</h3>

<p>Version can have dependencies, that include additional versions in to the main version. Dependencies refer to other
versions with full version name.</p>

<pre class="code ruby"><code class="ruby">    { &quot;version_id&quot;: &quot;my/component/23&quot;, &quot;name&quot;: &quot;comp&quot;, &quot;path&quot;: &quot;comp&quot;, &quot;internal&quot;: true,
      &quot;operations&quot;: [
        [
          &quot;cp&quot;, &quot;comp/test.sh&quot;, &quot;test.bat&quot;
        ]
      ]
    }
</code></pre>

<ul>
<li>version_id defines the full name of the required version</li>
<li>path defines a subdirectory where files from this dependency are placed</li>
<li>dependency can have a name, which makes it possible to compare version's dependencies and also navigate version hierarchies

<ul>
<li>navigation syntax: my/product/1>comp -> my/component/1</li>
<li>my/product/1>comp = my/component/23, my/product/2>comp -> my/component/24</li>
</ul>
</li>
<li>internal dependencies are visible in the version hierarchy only for top level version. comp is visible from my/product,
but if other version has a dependency on product, files from comp are not visible</li>
</ul>


<h3>File Operations</h3>

<p>Version can define file operations to modify the exported file structure. Operations can be defined at version level, so
that they affect version's all files (the ones defined in the version and brought by the dependencies). File operations
can also be defined per dependency.</p>

<p>Available file operations:</p>

<ul>
<li>cp - copy pattern1 pattern2 ... dest</li>
<li>mv - move pattern1 pattern2 ... dest</li>
<li>rm - remove.</li>
</ul>


<p>Examples, command line format - json storage format</p>

<pre class="code ruby"><code class="ruby"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rm *.txt</span><span class='tstring_end'>&quot;</span></span> <span class='op'>-</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rm</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>*.txt</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cp *.txt sub-directory</span><span class='tstring_end'>&quot;</span></span> <span class='op'>-</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cp</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>*.txt</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sub-directory</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mv *.sh scripts</span><span class='tstring_end'>&quot;</span></span> <span class='op'>-</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mv</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>*.sh</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>scripts</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
</code></pre>

<p>File operations are defined for "version-build" with -o and -O parameters</p>

<pre class="code ruby"><code class="ruby">ki version-build -d my/tests/a/123,name=tests -o &quot;rm *.txt&quot;
ki version-build -O &quot;cp scripts/start.sh start.sh&quot;
</code></pre>

<h3>Status information</h3>

<p>Each version can have status values. Status values can be used to tag certain kind of versions (released),
or find latest version that has a specific status value:</p>

<pre class="code ruby"><code class="ruby">my/component:released
my/component:IntegrationTest=green
</code></pre>

<h2>Component</h2>

<p>Component has only a two responsibilities:</p>

<ol>
<li>Keep a chronological list of versions</li>
<li>Store status value order for different status fields</li>
</ol>


<p>Status value order is used to determine which statuses match version queries:</p>

<pre class="code ruby"><code class="ruby">my/component:maturity&gt;alpha
</code></pre>

<p>"maturity" order could be "alpha,beta,gamma" and latest version that has either beta or gamma would get chosen.</p>

<h2>Repository</h2>

<p>Repository directory keeps a list of all components that have data in the repository.</p>

<h2>KiHome</h2>

<p>KiHome is the root directory for Ki. It contains repositories.</p>

<h1>Multiple repositories (TODO)</h1>

<p>Ki supports storing information to multiple repositories. It will be possible to use one repository for shared
artifacts like binaries and store statuses to a different repository. This way it's easy to support for example
team specific status values for artifacts produced by other team.</p>
</div></div>

    <div id="footer">
  Generated on Fri Aug  9 12:57:02 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7 (ruby-1.9.3).
</div>

  </body>
</html>